<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chat Virtual</title>

<style>
/* ===========================
   FULLSCREEN WHATSAPP-LIKE CHAT
   =========================== */

:root {
  --bg-page: #0b141a;
  --bg-chat: #efeae2;
  --header-bg: #075e54;
  --footer-bg: #f0f0f0;
  --bubble-user: #dcf8c6;
  --bubble-bot: #ffffff;
  --text-main: #111;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  width: 100%;
  overflow: hidden;
  background: var(--bg-page);
  font-family: Arial, sans-serif;
}

/* MAIN CONTAINER – FULLSCREEN */
#app {
  height: 100vh;
  width: 100vw;
  display: flex;
  flex-direction: column;
  background: var(--bg-chat);
}

/* HEADER */
.header {
  height: 65px;
  background: var(--header-bg);
  display: flex;
  align-items: center;
  padding: 0 14px;
  color: white;
  flex-shrink: 0;
}

.header img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 10px;
  border: 2px solid rgba(255,255,255,0.7);
}

.header .title {
  display: flex;
  flex-direction: column;
}

.header .title span:first-child {
  font-size: 18px;
  font-weight: bold;
}

.header .title span:last-child {
  font-size: 12px;
  opacity: 0.85;
}

/* CHAT AREA */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px 14px;
  background: var(--bg-chat);
  display: flex;              /* IMPORTANTE pro align-self funcionar */
  flex-direction: column;     /* Bubbles em coluna */
}

/* BUBBLES */
.bubble {
  max-width: 78%;
  padding: 10px 13px;
  margin-bottom: 12px;
  border-radius: 10px;
  font-size: 15px;
  line-height: 1.4;
  white-space: pre-wrap;
  color: var(--text-main);
}

.from-bot {
  background: var(--bubble-bot);
  align-self: flex-start;         /* ESQUERDA */
  border-bottom-left-radius: 0;
}

.from-user {
  background: var(--bubble-user);
  align-self: flex-end;           /* DIREITA */
  border-bottom-right-radius: 0;
}

/* FOOTER */
.footer {
  height: 70px;
  background: var(--footer-bg);
  display: flex;
  padding: 10px;
  align-items: center;
  gap: 10px;
  border-top: 1px solid #ccc;
  flex-shrink: 0;
}

.footer input {
  flex: 1;
  height: 48px;
  border-radius: 25px;
  border: 1px solid #ccc;
  padding: 0 15px;
  font-size: 15px;
}

.footer button {
  height: 48px;
  min-width: 85px;
  background: #128c7e;
  border: none;
  color: white;
  border-radius: 25px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
}

/* TYPING */
.typing {
  display: flex;
  align-items: center;
  gap: 4px;
}

.dot {
  width: 7px;
  height: 7px;
  background: #777;
  border-radius: 50%;
  animation: blink 1.4s infinite;
}

.dot:nth-child(2) { animation-delay: .2s; }
.dot:nth-child(3) { animation-delay: .4s; }

@keyframes blink {
  0% { opacity: .2; }
  50% { opacity: 1; }
  100% { opacity: .2; }
}

/* MOBILE AJUSTES */
@media (max-width: 600px) {
  .bubble { font-size: 14px; }
}
</style>

</head>

<body>
<div id="app">

  <div class="header">
    <img src="ft.jpeg" alt="Profile" />
    <div class="title">
      <span>Chat Virtual</span>
      <span>online now</span>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="footer">
    <input id="input" placeholder="Type your message..." autocomplete="off" />
    <button id="send">Send</button>
  </div>

</div>

<!-- NOTIFICATION SOUND -->
<audio id="notif">
  <source src="https://assets.mixkit.co/sfx/download/mixkit-software-interface-back-2575.wav">
</audio>

<script>
/* ========= DAILY GREETINGS ========= */
const DAILY = [
  "May God’s peace rest gently on your heart today. What would you like to share?",
  "You are not alone. God walks with you even now. Tell me what’s on your heart.",
  "Even on heavy days, grace is near. I'm here with you. What's going on today?",
  "God knows your worries and your hopes. What would you like to talk about?",
  "You are loved and seen by God. Whatever you're feeling, you can share it with me.",
  "Today is a new chance to breathe in His peace. How can I walk with you today?",
  "God holds your heart gently. What’s the first thing on your mind today?"
];

const API_KEY = "AIzaSyBYlGjOt-8z9JBJhaOXDgMDM277uop2JeM";  // <-- COLE SUA KEY AQUI
const MODEL = "gemini-flash-lite-latest";

/* ELEMENTS */
const messages = document.getElementById("messages");
const notif = document.getElementById("notif");
const input = document.getElementById("input");
const send = document.getElementById("send");

/* ADD MESSAGE */
function addBubble(msg, from="bot") {
  const div = document.createElement("div");
  div.className = "bubble " + (from === "user" ? "from-user" : "from-bot");
  div.textContent = msg;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

/* TYPING INDICATOR */
function typingShow() {
  const div = document.createElement("div");
  div.id = "typing";
  div.className = "bubble from-bot";
  div.innerHTML = `
    <div class="typing">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}
function typingHide() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

/* GEMINI CALL */
async function askGemini(text) {
  const prompt = `
You are a gentle Christian companion.
Speak only English.
Reply like a real conversation: short, warm, personal, human.
1–3 short sentences maximum.
Stay comforting and peaceful.
Message: "${text}"
`;

  const body = { contents: [{ role:"user", parts:[{ text:prompt }] }] };

  try {
    const res = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/" +
      MODEL +
      ":generateContent?key=" + API_KEY,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(body)
      }
    );

    const data = await res.json();
    console.log("AI response:", data);

    if (data.error) {
      console.error("API ERROR:", data.error);
      return "I'm sorry, there was a problem creating a response. You can try again in a moment.";
    }

    return (
      data?.candidates?.[0]?.content?.parts?.[0]?.text ||
      "I'm here for you. You can try again."
    );
  } catch (e) {
    console.error("REQUEST ERROR:", e);
    return "Something unexpected happened, but I’m still here for you.";
  }
}

/* SEND MESSAGE */
async function handleSend() {
  const txt = input.value.trim();
  if (!txt) return;

  addBubble(txt, "user");
  input.value = "";

  typingShow();
  const replyPromise = askGemini(txt);

  await new Promise(r => setTimeout(r, 250));

  const reply = await replyPromise;
  typingHide();

  try { notif.play(); } catch(e){}

  addBubble(reply, "bot");
}

/* EVENTS */
send.onclick = handleSend;
input.onkeydown = e => {
  if (e.key === "Enter") handleSend();
};

/* DAILY START MESSAGE */
setTimeout(() => {
  const day = new Date().getDate() % DAILY.length;
  addBubble(DAILY[day], "bot");
}, 600);
</script>

</body>
</html>
