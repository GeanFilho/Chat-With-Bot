<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sacred Talk</title>

<style>
:root {
  --bg-page: #0b141a;
  --bg-chat: #efeae2;
  --header-bg: #075e54;
  --footer-bg: #f0f0f0;
  --bubble-user: #dcf8c6;
  --bubble-bot: #ffffff;
  --text-main: #111;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  font-family: Arial, sans-serif;
  background: var(--bg-page);
}

body {
  min-height: 100dvh;
  overflow: hidden;
}

/* FULLSCREEN APP */
#app {
  width: 100vw;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  background: var(--bg-chat);
}

/* HEADER */
.header {
  height: 65px;
  background: var(--header-bg);
  display: flex;
  align-items: center;
  padding: 0 14px;
  color: white;
  flex-shrink: 0;
}

.header img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 10px;
  border: 2px solid rgba(255,255,255,0.7);
}

/* Title block (Name + Status) */
.header .title {
  display: flex;
  flex-direction: column;
  justify-content: center;
  line-height: 1.2;
}

.header .title .name {
  font-size: 18px;
  font-weight: bold;
}

.header .title .status {
  font-size: 12px;
  opacity: 0.85;
  margin-top: 2px;
}

/* CHAT AREA */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px 14px;
  background: var(--bg-chat);
  display: flex;
  flex-direction: column;
}

/* BUBBLES */
.bubble {
  max-width: 78%;
  padding: 11px 14px;
  margin-bottom: 12px;
  border-radius: 12px;
  font-size: 15px;
  line-height: 1.45;
  white-space: pre-wrap;
}

.from-bot {
  background: var(--bubble-bot);
  align-self: flex-start;
  border-bottom-left-radius: 4px;
}

.from-user {
  background: var(--bubble-user);
  align-self: flex-end;
  border-bottom-right-radius: 4px;
}

/* FOOTER */
.footer {
  height: 70px;
  background: var(--footer-bg);
  display: flex;
  padding: 10px;
  align-items: center;
  gap: 10px;
  border-top: 1px solid #ccc;
  flex-shrink: 0;
}

.footer input {
  flex: 1;
  height: 48px;
  border-radius: 25px;
  border: 1px solid #ccc;
  padding: 0 15px;
  font-size: 15px;
}

.footer button {
  height: 48px;
  min-width: 85px;
  background: #128c7e;
  border: none;
  color: white;
  border-radius: 25px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
}

/* TYPING */
.typing {
  display: flex;
  align-items: center;
  gap: 4px;
}

.dot {
  width: 7px;
  height: 7px;
  background: #777;
  border-radius: 50%;
  animation: blink 1.4s infinite;
}

.dot:nth-child(2) { animation-delay: .2s; }
.dot:nth-child(3) { animation-delay: .4s; }

@keyframes blink {
  0% { opacity: .2; }
  50% { opacity: 1; }
  100% { opacity: .2; }
}

/* MOBILE FIX */
@media (max-width: 600px) {
  .bubble { font-size: 14px; }
}
</style>
</head>

<body>
<div id="app">

  <div class="header">
    <img src="ftj.jpeg" alt="Profile" />
    <div class="title">
      <div class="name">Chat Virtual</div>
      <div class="status">online now</div>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="footer">
    <input id="input" placeholder="Type your message..." autocomplete="off" />
    <button id="send">Send</button>
  </div>

</div>

<audio id="notif">
  <source src="https://assets.mixkit.co/sfx/download/mixkit-software-interface-back-2575.wav">
</audio>

<script>
/* ===========================================
   ðŸ”‘ COLE SUA API KEY DO GEMINI AQUI
=========================================== */
const API_KEY = "AIzaSyBYlGjOt-8z9JBJhaOXDgMDM277uop2JeM";

/* Modelo atualizado */
const MODEL = "gemini-flash-latest";

/* Elements */
const messages = document.getElementById("messages");
const notif = document.getElementById("notif");
const input = document.getElementById("input");
const send = document.getElementById("send");

/* Add Bubble */
function addBubble(text, from = "bot") {
  const div = document.createElement("div");
  div.className = "bubble " + (from === "user" ? "from-user" : "from-bot");
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

/* Typing Animation */
function typingShow() {
  const div = document.createElement("div");
  div.id = "typing";
  div.className = "bubble from-bot";
  div.innerHTML = `
    <div class="typing">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function typingHide() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

/* Gemini Request */
async function askGemini(userText) {
  const prompt = `
You are a gentle, peaceful Christian companion.
Speak ONLY in English.
Sound natural, warm, and truly human â€” like a real conversation.

STYLE RULES:
- 2 to 4 short sentences.
- Soft, comforting tone.
- Human, warm, personal.
- Avoid robotic or generic phrasing.
- Maintain a calm, spiritual vibe.

User said: "${userText}"
`;

  const body = {
    contents: [
      {
        role: "user",
        parts: [{ text: prompt }]
      }
    ]
  };

  try {
    const res = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/" +
        MODEL +
        ":generateContent?key=" + API_KEY,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      }
    );

    const data = await res.json();
    console.log("AI:", data);

    if (data.error)
      return "I'm sorry, something went wrong. You can try again whenever you're ready.";

    return data?.candidates?.[0]?.content?.parts?.[0]?.text ||
           "I'm here with you. Try again if you'd like.";

  } catch (e) {
    return "Iâ€™m still here with you, even if something went wrong.";
  }
}

/* SEND MESSAGE */
async function handleSend() {
  const text = input.value.trim();
  if (!text) return;

  addBubble(text, "user");
  input.value = "";

  typingShow();
  const replyPromise = askGemini(text);

  await new Promise((r) => setTimeout(r, 300));

  const reply = await replyPromise;
  typingHide();

  try { notif.play(); } catch(e){}

  addBubble(reply, "bot");
}

send.onclick = handleSend;
input.onkeydown = (e) => {
  if (e.key === "Enter") handleSend();
};
</script>
</body>
</html>
