<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chat Virtual</title>

<style>
/* ===========================
   FULLSCREEN WHATSAPP-LIKE CHAT
   =========================== */

:root {
  --bg-page: #0b141a;
  --bg-app: #efeae2;
  --header-bg: #075e54;
  --footer-bg: #f0f0f0;
  --bubble-user: #dcf8c6;
  --bubble-bot: #ffffff;
  --text-main: #111;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  background: var(--bg-page);
  font-family: Arial, sans-serif;
  height: 100vh;
  overflow: hidden;
}

/* MAIN CONTAINER */
#app {
  width: 100%;
  height: 100dvh; /* melhor para mobile */
  max-width: 900px;
  margin: 0 auto;
  background: var(--bg-app);
  display: flex;
  flex-direction: column;
  box-shadow: 0 0 18px rgba(0,0,0,0.35);
}

/* HEADER */
.header {
  height: 64px;
  background: var(--header-bg);
  display: flex;
  align-items: center;
  padding: 0 12px;
  color: white;
}

.header img {
  width: 44px;
  height: 44px;
  background: #fff;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 10px;
  border: 2px solid rgba(255,255,255,0.6);
}

.header .title {
  display: flex;
  flex-direction: column;
}

.header .title span:first-child {
  font-size: 17px;
  font-weight: 600;
}

.header .title span:last-child {
  font-size: 12px;
  opacity: 0.85;
}

/* MESSAGES AREA */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 14px 12px;
  display: flex;
  flex-direction: column;
  background: url("https://i.imgur.com/k1hVtFZ.png") repeat;
  background-size: 320px 320px;
}

/* BUBBLES */
.bubble {
  max-width: 78%;
  padding: 9px 11px;
  margin-bottom: 10px;
  border-radius: 9px;
  font-size: 15px;
  line-height: 1.35;
  color: var(--text-main);
  word-wrap: break-word;
  white-space: pre-wrap;
}

.from-bot {
  background: var(--bubble-bot);
  align-self: flex-start;
  border-bottom-left-radius: 0;
}

.from-user {
  background: var(--bubble-user);
  align-self: flex-end;
  border-bottom-right-radius: 0;
}

/* FOOTER */
.footer {
  min-height: 60px;
  background: var(--footer-bg);
  display: flex;
  padding: 7px;
  align-items: center;
  border-top: 1px solid #ccc;
  gap: 6px;
}

.footer input {
  flex: 1;
  height: 46px;
  border-radius: 23px;
  border: 1px solid #ccc;
  padding: 0 14px;
  font-size: 15px;
}

.footer button {
  height: 46px;
  min-width: 78px;
  background: #128c7e;
  border: none;
  color: white;
  border-radius: 23px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

/* TYPING */
.typing {
  display: flex;
  align-items: center;
  gap: 4px;
}

.dot {
  width: 7px;
  height: 7px;
  background: #777;
  border-radius: 50%;
  animation: blink 1.4s infinite;
}

.dot:nth-child(2) { animation-delay: .2s; }
.dot:nth-child(3) { animation-delay: .4s; }

@keyframes blink {
  0% { opacity: .2; }
  50% { opacity: 1; }
  100% { opacity: .2; }
}

/* SMALL SCREENS */
@media (max-width: 600px) {
  #app {
    max-width: 100%;
    height: 100dvh;
    box-shadow: none;
  }

  .messages {
    padding: 10px 8px;
  }

  .bubble {
    font-size: 14px;
  }
}
</style>

</head>

<body>
<div id="app">

  <div class="header">
    <img src="ft.jpeg" alt="Profile" />
    <div class="title">
      <span>Chat Virtual</span>
      <span>online now</span>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="footer">
    <input id="input" placeholder="Type your message..." autocomplete="off" />
    <button id="send">Send</button>
  </div>

</div>

<!-- NOTIFICATION SOUND -->
<audio id="notif">
  <source src="https://assets.mixkit.co/sfx/download/mixkit-software-interface-back-2575.wav">
</audio>

<script>
/* ============ CONFIG ============ */

/* PUT YOUR API KEY HERE */
const API_KEY = "AIzaSyBYlGjOt-8z9JBJhaOXDgMDM277uop2JeM"; // <-- paste your Google AI Studio key here
const MODEL_NAME = "/gemini-flash-latest";

/* DAILY COMFORTING RELIGIOUS GREETINGS (ENGLISH ONLY) */
const DAILY_GREETINGS = [
  "May the peace of Christ calm your heart today. What would you like to share with me?",
  "You are not alone today. God walks with you in every step. What’s on your mind?",
  "God knows your heart even when words are hard to find. How can I be here for you right now?",
  "Today is a new chance to rest in God’s love. What would you like to talk about?",
  "Even on heavy days, grace is still near. Tell me what you’re feeling today.",
  "God sees every tear and every small victory. What’s happening in your heart today?",
  "You are loved, seen, and held by God. What would you like to open up about today?"
];

/* CHOOSE GREETING BASED ON DAY (CHANGES EVERY DAY) */
function getDailyGreeting() {
  const today = new Date();
  const index = today.getDate() % DAILY_GREETINGS.length;
  return DAILY_GREETINGS[index];
}

/* ELEMENTS */
const messages = document.getElementById("messages");
const notif = document.getElementById("notif");
const input = document.getElementById("input");
const send = document.getElementById("send");

/* ADD MESSAGE BUBBLE */
function addBubble(text, from = "bot") {
  const div = document.createElement("div");
  div.className = "bubble " + (from === "user" ? "from-user" : "from-bot");
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

/* TYPING INDICATOR */
function showTyping() {
  const div = document.createElement("div");
  div.id = "typing";
  div.className = "bubble from-bot";
  div.innerHTML = `
    <div class="typing">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}
function hideTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

/* CALL GEMINI */
async function askGemini(userText) {
  const prompt = `
You are a gentle, warm, Christian spiritual companion.
Speak in natural, simple English, like a close friend who believes in God.
Always reply with short, comforting messages (1 to 3 short sentences).
Be personal, empathetic, calm and encouraging.
Never preach or lecture, just walk beside the person.
User message: "${userText}"
  `;

  const body = {
    contents: [
      {
        role: "user",
        parts: [{ text: prompt }]
      }
    ]
  };

  try {
    const url =
      "https://generativelanguage.googleapis.com/v1beta/models/" +
      MODEL_NAME +
      ":generateContent?key=" +
      API_KEY;

    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    console.log("AI response:", data);

    if (data.error) {
      console.error("API ERROR:", data.error);
      return "I’m sorry, there was a problem creating a response. You can try again in a moment.";
    }

    return (
      data?.candidates?.[0]?.content?.parts?.[0]?.text ||
      "I’m sorry, I couldn’t find the right words right now, but I’m here with you."
    );

  } catch (e) {
    console.error("REQUEST ERROR:", e);
    return "Something unexpected happened, but I’m still here for you.";
  }
}

/* SEND HANDLER */
async function handleSend() {
  const text = input.value.trim();
  if (!text) return;

  addBubble(text, "user");
  input.value = "";

  showTyping();

  const replyPromise = askGemini(text);

  // Small delay just to make typing feel natural
  await new Promise(r => setTimeout(r, 250));

  const reply = await replyPromise;

  hideTyping();

  try { notif.play(); } catch (e) {}

  addBubble(reply, "bot");
}

/* EVENTS */
send.onclick = handleSend;
input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") handleSend();
});

/* INITIAL DAILY MESSAGE */
setTimeout(() => {
  addBubble(getDailyGreeting(), "bot");
}, 500);
</script>

</body>
</html>
